rules_version = '2';

service firebase.storage {
  match /b/{bucket}/o {
    match /samples {
        // every can read everything
        match /{allSamples=**} {
            allow read;
        }

        // only admin can upload public
        match /public/{sample} {
            allow write: if request.auth != null && requestIsAudioFile(request); // todo: if admin
        }

        // users can upload in their own folder
        match /user/{userId}/{sample} {
            allow write: if request.auth.uid == userId && requestIsAudioFile(request);
        }
    }

  }
}

function requestIsAudioFile(request) {
    return request.resource.contentType.matches('audio/.*');
}